---
layout: post
title:  "[JAVA] Java 中的多线程编程（二） 多线程安全问题"
date:   2016-08-02
desc: "how to use thread in Java"
keywords: "java, thread"
categories: [Java]
tags: [Java]
icon: fa-keyboard-o
---

# Java 中多线程编程二： 多线程安全问题


## I. 线程安全

### 1. 多线程的问题：

那么首先来看多线程为什么出现问题（出问题的标准）：

-	```是否是多线程环境```，因为单线程程序只要逻辑正确就没有问题
-	```是否有共享数据```， 没有共享数据的话，每个线程只访问和操作自己特有的数据，也不会出问题
-	```是否有多条语句操作共享数据```，
	-	因为 cpu 执行指令的原子性，cpu 一次执行一个原子性操作，比如一次加法或者一次赋值
	-	如果有多个线程，每个线程对共享数据的操作只有一个原子性的操作，那么数据也不会出问题
	-	但如果，每个线程中都有多条操作语句操作共享数据，比如 ```A；B；C;``` 三个语句，对共享数据进行操作，理想顺序是线程1执行完 ABC，线程2再执行ABC
	-	但是由于多线程执行的随机性，有可能线程1执行到B的时候，线程1就执行了A，那么得到的值就和期待值不同
	-	于是多线程问题就出现了

所以程序中，满足了上面三个条件，就存在线程的安全问题的！

### 2. 解决线程安全问题的基本思想

当程序满足了上面三个条件，出现了安全问题，那么如何解决呢？

-	基本思想：

前两个条件一般是不能进行更改的，所以要从第三个条件入手。如果我们把多条语句操作共享数据的代码给包装成一个整体，比如 ```A; B; C;``` 三个语句，我们让一个线程在执行这三个语句的时候，一次性把他们当作一个语句执行了。就是说，线程1在执行这个语句的整体的时候，线程2就不会去执行这个包装好的整体语句。所以就不会出现线程1才执行到 B 语句，线程二就执行到A语句的情况了。

-	怎么实现：Java 给我们提供了 ```同步机制```
